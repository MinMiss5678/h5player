<!-- 注：本页内容不允许压缩，且功能必须足够简单，以方便其他人进行安全性审查 -->
<!DOCTYPE html>
<html>

<head>
  <title>H5player remote helper</title>
</head>

<body>
  <script>
    const urlParams = new URLSearchParams(window.location.search)
    let isSamePage = false
    try {
      if (window.parent !== window && window.parent.location.href.startsWith(location.origin + location.pathname)) { isSamePage = true; }
    } catch (e) { isSamePage = false; }

    /* 发起使用统计请求，不包含任何隐私信息 */
    function usageStatistics() {
      if (isSamePage || urlParams.get('tag')) return;

      /* 确保24小时内只发送一次统计请求 */
      const lastStatisticsTime = localStorage.getItem('lastStatisticsTime')
      if (lastStatisticsTime && Date.now() - lastStatisticsTime < 1000 * 60 * 60 * 23.9) return;

      const dateStr = new Date().toISOString().split('T')[0].replace(/-/g, '')
      const timeStr = dateStr + new Date().getHours()

      const urlMap = {
        first: `https://u.anzz.top/h5phelperfirst?t=${dateStr}`,
        oldVersion: `https://u.anzz.top/h5phelper?t=${timeStr}`,
        newVersion: `https://u.anzz.top/h5phelperdays?t=${dateStr}`
      }

      let url = urlMap.oldVersion
      if (!urlParams.get('lst')) {
        url = urlMap.oldVersion
      } else if (urlParams.get('lst') == '0') {
        url = urlMap.first
      } else {
        url = urlMap.newVersion
      }

      const iframe = document.createElement('iframe')
      iframe.src = url
      iframe.style.display = 'none'
      document.body.appendChild(iframe)

      localStorage.setItem('lastStatisticsTime', Date.now())
    }
    usageStatistics()

    const recommendList = [
      {
        title: "【Free GPT-4】Provided by the overseas team of ByteDance",
        url: "https://u.anzz.top/ai",
        i18n: {
          "zh": {
            title: "【免费GPT-4】由字节跳动海外团队提供",
            url: "https://u.anzz.top/h5precommend"
          }
        }
      },
      {
        title: "【限时优惠】GPT-4+MJ永久会员298元，国内可用",
        url: "https://u.anzz.top/huluai",
        lang: ["zh"],
        disabled: false
      },
      {
        title: "100万级安装量的开源作品，一年有多少打赏收入？",
        url: "https://u.anzz.top/aboutdonate",
        i18n: {
          "en": {
            title: "How much reward income does an open source work with 1 million installations generate in a year?"
          }
        }
      },
      {
        title: "音视频一键合并工具，无需二次编码",
        url: "https://github.com/xxxily/ffmpeg-script",
        desc: "将h5player下载到的音视频文件自动合并成一个文件，不经过二次编码，可快速合并",
        i18n: {
          "en": {
            title: "Audio and video merge tool, no secondary coding required",
            desc: "Automatically merge the audio and video files downloaded by h5player into one file without secondary coding, which can be quickly merged"
          }
        },
        disabled: true
      }
    ];

    if(!isSamePage){
      window.recommendList = recommendList
      window.remoteHelperSyncInterval = 1000 * 60 * 60 * 4
      window.remoteVersion = undefined
    }
  </script>
</body>

</html>